<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éŸ³è¨Šè½‰æ–‡å­—å·¥å…·/å‹Ÿè³‡æ–‡æ¡ˆç”Ÿæˆå™¨/æ–‡æ¡ˆæª¢æ¸¬</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    
    .upload-section {
      border: 2px dashed #ddd;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      margin-bottom: 30px;
      transition: border-color 0.3s;
    }
    
    .upload-section:hover {
      border-color: #007bff;
    }
    
    .upload-section.dragover {
      border-color: #007bff;
      background-color: #f8f9fa;
    }
    
    .file-input {
      display: none;
    }
    
    .upload-btn {
      background: #007bff;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px;
    }
    
    .upload-btn:hover {
      background: #0056b3;
    }
    
    .upload-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    
    .file-info {
      margin: 20px 0;
      padding: 10px;
      background: #e9ecef;
      border-radius: 5px;
      display: none;
    }
    
    .result-section {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 5px;
      display: none;
    }
    
    .result-text {
      background: white;
      padding: 15px;
      border-radius: 5px;
      border-left: 4px solid #007bff;
      white-space: pre-wrap;
      line-height: 1.6;
    }
    
    .loading {
      text-align: center;
      color: #007bff;
    }
    
    .error {
      color: #dc3545;
      background: #f8d7da;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }
    
    .success {
      color: #155724;
      background: #d4edda;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }
    
    .form-section {
      margin-top: 40px;
      padding: 30px;
      background: #f8f9fa;
      border-radius: 10px;
      border: 1px solid #dee2e6;
    }
    
    .form-title {
      color: #333;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    
    .form-group label {
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #007bff;
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .generate-btn {
      background: #28a745;
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      margin-top: 20px;
    }
    
    .generate-btn:hover {
      background: #218838;
    }
    
    .generate-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    
    .copy-result {
      margin-top: 30px;
      padding: 20px;
      background: white;
      border-radius: 5px;
      border-left: 4px solid #28a745;
      display: none;
    }
    
    .copy-text {
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 14px;
    }
    
    .copy-actions {
      margin-top: 15px;
      text-align: right;
    }
    
    .copy-btn {
      background: #007bff;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
      margin-left: 10px;
    }
    
    .copy-btn:hover {
      background: #0056b3;
    }
    
    .check-btn {
      background: #ffc107;
      color: #212529;
    }
    
    .check-btn:hover {
      background: #e0a800;
    }
    
    .check-result {
      margin-top: 20px;
      padding: 20px;
      background: white;
      border-radius: 5px;
      border-left: 4px solid #ffc107;
      display: none;
    }
    
    .check-section {
      margin-bottom: 20px;
    }
    
    .check-section h4 {
      margin: 0 0 10px 0;
      color: #333;
      font-size: 16px;
    }
    
    .check-item {
      padding: 10px;
      margin: 5px 0;
      border-radius: 3px;
      font-size: 14px;
    }
    
    .check-item.pass {
      background: #d4edda;
      color: #155724;
      border-left: 3px solid #28a745;
    }
    
    .check-item.warning {
      background: #fff3cd;
      color: #856404;
      border-left: 3px solid #ffc107;
    }
    
    .check-item.error {
      background: #f8d7da;
      color: #721c24;
      border-left: 3px solid #dc3545;
    }
    
    .check-summary {
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 15px;
      font-weight: bold;
    }
    
    .check-summary.pass {
      background: #d4edda;
      color: #155724;
    }
    
    .check-summary.warning {
      background: #fff3cd;
      color: #856404;
    }
    
    .check-summary.error {
      background: #f8d7da;
      color: #721c24;
    }
    
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸµ éŸ³è¨Šè½‰æ–‡å­—å·¥å…· & ğŸ“ å‹Ÿè³‡æ–‡æ¡ˆç”Ÿæˆå™¨ & ğŸ” æ–‡æ¡ˆæª¢æ¸¬</h1>
    
    <div class="upload-section" id="uploadSection">
      <p>è«‹é¸æ“‡éŸ³è¨Šæª”æ¡ˆæˆ–æ‹–æ‹½æª”æ¡ˆåˆ°æ­¤å€åŸŸ</p>
      <input type="file" id="audioFile" class="file-input" accept="audio/*">
      <button class="upload-btn" onclick="document.getElementById('audioFile').click()">
        é¸æ“‡éŸ³è¨Šæª”æ¡ˆ
      </button>
      <p style="color: #666; font-size: 14px; margin-top: 10px;">
        æ”¯æ´æ ¼å¼ï¼šMP3, WAV, M4A, FLAC ç­‰éŸ³è¨Šæ ¼å¼<br>
        æª”æ¡ˆå¤§å°é™åˆ¶ï¼š25MB
      </p>
    </div>
    
    <div class="file-info" id="fileInfo">
      <strong>å·²é¸æ“‡æª”æ¡ˆï¼š</strong>
      <span id="fileName"></span>
      <br>
      <strong>æª”æ¡ˆå¤§å°ï¼š</strong>
      <span id="fileSize"></span>
    </div>
    
    <div class="result-section" id="resultSection">
      <h3>è½‰éŒ„çµæœï¼š</h3>
      <div class="result-text" id="resultText"></div>
    </div>
    
    <!-- å‹Ÿè³‡æ–‡æ¡ˆç”Ÿæˆè¡¨å–® -->
    <div class="form-section">
      <h2 class="form-title">ğŸ“ å‹Ÿè³‡æ–‡æ¡ˆç”Ÿæˆå™¨</h2>
      <form id="fundraisingForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="project_name">å°ˆæ¡ˆåç¨± *</label>
            <input type="text" id="project_name" name="project_name" required placeholder="è«‹è¼¸å…¥æ‚¨çš„å°ˆæ¡ˆåç¨±" value="å‰µæ–°ç§‘æŠ€ç”¢å“å‹Ÿè³‡å°ˆæ¡ˆ">
          </div>
          
          <div class="form-group">
            <label for="target_fund">å‹Ÿè³‡ç›®æ¨™</label>
            <input type="text" id="target_fund" name="target_fund" placeholder="ä¾‹ï¼š100è¬" value="100è¬">
          </div>
          
          <div class="form-group">
            <label for="start_date">é–‹å§‹æ—¥æœŸ</label>
            <input type="date" id="start_date" name="start_date">
          </div>
          
          <div class="form-group">
            <label for="end_date">çµæŸæ—¥æœŸ</label>
            <input type="date" id="end_date" name="end_date">
          </div>
          
          <div class="form-group">
            <label for="product_type">ç”¢å“é¡å‹</label>
            <select id="product_type" name="product_type">
              <option value="">è«‹é¸æ“‡ç”¢å“é¡å‹</option>
              <option value="ç§‘æŠ€ç”¢å“" selected>ç§‘æŠ€ç”¢å“</option>
              <option value="ç”Ÿæ´»ç”¨å“">ç”Ÿæ´»ç”¨å“</option>
              <option value="æ–‡å‰µå•†å“">æ–‡å‰µå•†å“</option>
              <option value="é£Ÿå“é£²æ–™">é£Ÿå“é£²æ–™</option>
              <option value="æœé£¾é…ä»¶">æœé£¾é…ä»¶</option>
              <option value="å±…å®¶ç”¨å“">å±…å®¶ç”¨å“</option>
              <option value="é‹å‹•å¥èº«">é‹å‹•å¥èº«</option>
              <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="tone_style">æ–‡æ¡ˆé¢¨æ ¼</label>
            <select id="tone_style" name="tone_style">
              <option value="å°ˆæ¥­å‹å–„" selected>å°ˆæ¥­å‹å–„</option>
              <option value="æ´»æ½‘æœ‰è¶£">æ´»æ½‘æœ‰è¶£</option>
              <option value="æº«é¦¨æ„Ÿäºº">æº«é¦¨æ„Ÿäºº</option>
              <option value="ç§‘æŠ€æ„Ÿ">ç§‘æŠ€æ„Ÿ</option>
              <option value="æ–‡é’é¢¨æ ¼">æ–‡é’é¢¨æ ¼</option>
              <option value="ç°¡ç´„æ¸…æ–°">ç°¡ç´„æ¸…æ–°</option>
            </select>
          </div>
          
          <div class="form-group full-width">
            <label for="brand_background">å“ç‰ŒèƒŒæ™¯</label>
            <textarea id="brand_background" name="brand_background" placeholder="è«‹æè¿°æ‚¨çš„å“ç‰Œæ•…äº‹ã€å‰µç«‹ç†å¿µã€åœ˜éšŠèƒŒæ™¯ç­‰...">æˆ‘å€‘æ˜¯ä¸€ç¾¤ç†±æ„›å‰µæ–°çš„åœ˜éšŠï¼Œè‡´åŠ›æ–¼é–‹ç™¼èƒ½å¤ æ”¹å–„äººå€‘ç”Ÿæ´»çš„ç”¢å“ã€‚æ†‘è—‰å¤šå¹´çš„è¡Œæ¥­ç¶“é©—å’Œå°å¸‚å ´éœ€æ±‚çš„æ·±åº¦ç†è§£ï¼Œæˆ‘å€‘å¸Œæœ›é€éé€™å€‹å°ˆæ¡ˆèˆ‡å¤§å®¶åˆ†äº«æˆ‘å€‘çš„ç†å¿µå’Œç”¢å“ã€‚</textarea>
          </div>
          
          <div class="form-group full-width">
            <label for="core_features">æ ¸å¿ƒç‰¹è‰²</label>
            <textarea id="core_features" name="core_features" placeholder="è«‹æè¿°ç”¢å“çš„ä¸»è¦åŠŸèƒ½ã€ç‰¹è‰²ã€å‰µæ–°é»ç­‰...">â€¢ å‰µæ–°è¨­è¨ˆç†å¿µï¼Œçµåˆå¯¦ç”¨æ€§èˆ‡ç¾è§€æ€§
â€¢ é«˜å“è³ªææ–™è£½ä½œï¼Œç¢ºä¿ç”¢å“è€ç”¨æ€§
â€¢ äººæ€§åŒ–æ“ä½œä»‹é¢ï¼Œç°¡å–®æ˜“ç”¨
â€¢ ç’°ä¿æè³ªï¼Œç¬¦åˆæ°¸çºŒç™¼å±•ç†å¿µ
â€¢ ç¨ç‰¹åŠŸèƒ½ï¼Œè§£æ±ºç¾æœ‰ç”¢å“çš„ç—›é»</textarea>
          </div>
          
          <div class="form-group full-width">
            <label for="target_audience">ç›®æ¨™æ—ç¾¤</label>
            <textarea id="target_audience" name="target_audience" placeholder="è«‹æè¿°æ‚¨çš„ç›®æ¨™å®¢æˆ¶ç¾¤é«”ã€å¹´é½¡å±¤ã€èˆˆè¶£æ„›å¥½ç­‰...">ä¸»è¦é‡å°25-45æ­²çš„éƒ½å¸‚ä¸Šç­æ—ï¼Œä»–å€‘æ³¨é‡ç”Ÿæ´»å“è³ªï¼Œé¡˜æ„å˜—è©¦æ–°ç”¢å“ï¼Œå°ç§‘æŠ€ç”¢å“æœ‰ä¸€å®šçš„æ¥å—åº¦ï¼Œä¸¦ä¸”é‡è¦–ç”¢å“çš„å¯¦ç”¨æ€§å’Œè¨­è¨ˆæ„Ÿã€‚é€™ç¾¤æ¶ˆè²»è€…é€šå¸¸æœ‰ä¸€å®šçš„æ¶ˆè²»èƒ½åŠ›ï¼Œè¿½æ±‚ä¾¿åˆ©æ€§å’Œæ•ˆç‡ã€‚</textarea>
          </div>
        </div>
        
        <button type="submit" class="generate-btn" id="generateBtn">
          ğŸš€ ç”Ÿæˆå‹Ÿè³‡æ–‡æ¡ˆ
        </button>
      </form>
      
      <div class="copy-result" id="copyResult">
        <h3>ç”Ÿæˆçš„å‹Ÿè³‡æ–‡æ¡ˆï¼š</h3>
        <div class="copy-text" id="copyText"></div>
        <div class="copy-actions">
          <button class="copy-btn" id="copyBtn">ğŸ“‹ è¤‡è£½æ–‡æ¡ˆ</button>
          <button class="copy-btn check-btn" id="checkBtn">ğŸ” æª¢æ¸¬æ–‡æ¡ˆ</button>
          <button class="copy-btn" id="regenerateBtn">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
        </div>
        
        <!-- æª¢æ¸¬çµæœå€åŸŸ -->
        <div class="check-result" id="checkResult">
          <h3>ğŸ” æ–‡æ¡ˆæª¢æ¸¬çµæœ</h3>
          <div id="checkContent"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const audioFile = document.getElementById('audioFile');
    const uploadSection = document.getElementById('uploadSection');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const resultSection = document.getElementById('resultSection');
    const resultText = document.getElementById('resultText');
    const uploadBtn = document.querySelector('.upload-btn');
    
    // å‹Ÿè³‡æ–‡æ¡ˆç”Ÿæˆç›¸é—œå…ƒç´ 
    const fundraisingForm = document.getElementById('fundraisingForm');
    const generateBtn = document.getElementById('generateBtn');
    const copyResult = document.getElementById('copyResult');
    const copyText = document.getElementById('copyText');
    const copyBtn = document.getElementById('copyBtn');
    const checkBtn = document.getElementById('checkBtn');
    const checkResult = document.getElementById('checkResult');
    const checkContent = document.getElementById('checkContent');
    const regenerateBtn = document.getElementById('regenerateBtn');

    // æª”æ¡ˆé¸æ“‡è™•ç†
    audioFile.addEventListener('change', handleFileSelect);
    
    // å‹Ÿè³‡æ–‡æ¡ˆè¡¨å–®æäº¤è™•ç†
    fundraisingForm.addEventListener('submit', handleFundraisingSubmit);
    
    // è¤‡è£½æ–‡æ¡ˆæŒ‰éˆ•
    copyBtn.addEventListener('click', copyToClipboard);
    
    // æª¢æ¸¬æ–‡æ¡ˆæŒ‰éˆ•
    checkBtn.addEventListener('click', checkCopy);
    
    // é‡æ–°ç”ŸæˆæŒ‰éˆ•
    regenerateBtn.addEventListener('click', () => {
      copyResult.style.display = 'none';
      checkResult.style.display = 'none';
      generateBtn.disabled = false;
      generateBtn.textContent = 'ğŸš€ ç”Ÿæˆå‹Ÿè³‡æ–‡æ¡ˆ';
    });
    
    // è¨­ç½®æ—¥æœŸé è¨­å€¼
    function setDefaultDates() {
      const today = new Date();
      const startDate = new Date(today);
      const endDate = new Date(today);
      endDate.setDate(today.getDate() + 30); // é è¨­30å¤©å‹Ÿè³‡æœŸé–“
      
      document.getElementById('start_date').value = startDate.toISOString().split('T')[0];
      document.getElementById('end_date').value = endDate.toISOString().split('T')[0];
    }
    
    // é é¢è¼‰å…¥æ™‚è¨­ç½®é è¨­å€¼
    document.addEventListener('DOMContentLoaded', setDefaultDates);

    // æ‹–æ‹½åŠŸèƒ½
    uploadSection.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadSection.classList.add('dragover');
    });

    uploadSection.addEventListener('dragleave', () => {
      uploadSection.classList.remove('dragover');
    });

    uploadSection.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadSection.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        audioFile.files = files;
        handleFileSelect();
      }
    });

    function handleFileSelect() {
      const file = audioFile.files[0];
      if (file) {
        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);
        fileInfo.style.display = 'block';
        
        // è‡ªå‹•ä¸Šå‚³æª”æ¡ˆ
        uploadAudio(file);
      }
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    async function uploadAudio(file) {
      const formData = new FormData();
      formData.append('audio', file);

      // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      uploadBtn.disabled = true;
      uploadBtn.textContent = 'è½‰éŒ„ä¸­...';
      resultSection.style.display = 'block';
      resultText.innerHTML = '<div class="loading">æ­£åœ¨è½‰éŒ„éŸ³è¨Šï¼Œè«‹ç¨å€™...</div>';

      try {
        const response = await fetch('/api/transcribe', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (response.ok) {
          resultText.innerHTML = `<div class="success">è½‰éŒ„æˆåŠŸï¼</div><div class="result-text">${data.text}</div>`;
        } else {
          resultText.innerHTML = `<div class="error">è½‰éŒ„å¤±æ•—ï¼š${data.error}</div>`;
        }
      } catch (error) {
        resultText.innerHTML = `<div class="error">ç¶²è·¯éŒ¯èª¤ï¼š${error.message}</div>`;
      } finally {
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'é¸æ“‡éŸ³è¨Šæª”æ¡ˆ';
      }
    }

    // å‹Ÿè³‡æ–‡æ¡ˆç”Ÿæˆè™•ç†
    async function handleFundraisingSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(fundraisingForm);
      const projectData = {};
      
      // æ”¶é›†è¡¨å–®è³‡æ–™
      for (let [key, value] of formData.entries()) {
        projectData[key] = value;
      }
      
      // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      generateBtn.disabled = true;
      generateBtn.textContent = 'ç”Ÿæˆä¸­...';
      copyResult.style.display = 'block';
      copyText.innerHTML = '<div class="loading">æ­£åœ¨ç”Ÿæˆå‹Ÿè³‡æ–‡æ¡ˆï¼Œè«‹ç¨å€™...</div>';
      
      try {
        const response = await fetch('/api/fundraising/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(projectData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
          copyText.innerHTML = `<div class="success">æ–‡æ¡ˆç”ŸæˆæˆåŠŸï¼</div><div class="copy-text">${data.result}</div>`;
        } else {
          copyText.innerHTML = `<div class="error">ç”Ÿæˆå¤±æ•—ï¼š${data.error}</div>`;
        }
      } catch (error) {
        copyText.innerHTML = `<div class="error">ç¶²è·¯éŒ¯èª¤ï¼š${error.message}</div>`;
      } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = 'ğŸš€ ç”Ÿæˆå‹Ÿè³‡æ–‡æ¡ˆ';
      }
    }
    
    // è¤‡è£½åˆ°å‰ªè²¼ç°¿
    async function copyToClipboard() {
      try {
        await navigator.clipboard.writeText(copyText.textContent);
        
        // é¡¯ç¤ºè¤‡è£½æˆåŠŸæç¤º
        const originalText = copyBtn.textContent;
        copyBtn.textContent = 'âœ… å·²è¤‡è£½';
        copyBtn.style.background = '#28a745';
        
        setTimeout(() => {
          copyBtn.textContent = originalText;
          copyBtn.style.background = '#007bff';
        }, 2000);
      } catch (error) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½æ–‡æ¡ˆå…§å®¹');
      }
    }
    
    // æª¢æ¸¬æ–‡æ¡ˆåŠŸèƒ½
    async function checkCopy() {
      // æª¢æŸ¥æ˜¯å¦æœ‰ç”Ÿæˆçš„æ–‡æ¡ˆ
      const copyTextContent = copyText.textContent.trim();
      if (!copyTextContent || copyTextContent.includes('æ­£åœ¨ç”Ÿæˆ') || copyTextContent.includes('ç”Ÿæˆå¤±æ•—') || copyTextContent.includes('ç¶²è·¯éŒ¯èª¤')) {
        alert('è«‹å…ˆç”Ÿæˆå‹Ÿè³‡æ–‡æ¡ˆå†é€²è¡Œæª¢æ¸¬');
        return;
      }
      
      // æ”¶é›†è¡¨å–®è³‡æ–™
      const formData = new FormData(fundraisingForm);
      const projectData = {};
      for (let [key, value] of formData.entries()) {
        projectData[key] = value;
      }
      
      // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      checkBtn.disabled = true;
      checkBtn.textContent = 'æª¢æ¸¬ä¸­...';
      checkResult.style.display = 'block';
      checkContent.innerHTML = '<div class="loading">æ­£åœ¨æª¢æ¸¬æ–‡æ¡ˆï¼Œè«‹ç¨å€™...</div>';
      
      try {
        const response = await fetch('/api/fundraising/check', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            copyContent: copyTextContent,
            projectData: projectData
          })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          displayCheckResults(data);
        } else {
          checkContent.innerHTML = `<div class="error">æª¢æ¸¬å¤±æ•—ï¼š${data.error}</div>`;
        }
      } catch (error) {
        checkContent.innerHTML = `<div class="error">ç¶²è·¯éŒ¯èª¤ï¼š${error.message}</div>`;
      } finally {
        checkBtn.disabled = false;
        checkBtn.textContent = 'ğŸ” æª¢æ¸¬æ–‡æ¡ˆ';
      }
    }
    
    // é¡¯ç¤ºæª¢æ¸¬çµæœ
    function displayCheckResults(data) {
      let html = '';
      
      // ç¸½é«”æª¢æ¸¬çµæœ
      const hasSensitiveContent = data.sensitiveCheckResult?.hasSensitiveContent || false;
      const hasRegulatoryIssues = data.regulatoryCheckResult?.hasRegulatoryIssues || false;
      const hasMissingElements = data.regulatoryCheckResult?.missingElements?.length > 0 || false;
      
      let overallStatus = 'pass';
      let statusText = 'âœ… æª¢æ¸¬é€šé';
      
      if (hasSensitiveContent || hasRegulatoryIssues) {
        overallStatus = 'error';
        statusText = 'âŒ æª¢æ¸¬æœªé€šé';
      } else if (hasMissingElements) {
        overallStatus = 'warning';
        statusText = 'âš ï¸ éœ€è¦æ³¨æ„';
      }
      
      html += `<div class="check-summary ${overallStatus}">${statusText}</div>`;
      
      // æ•æ„Ÿè©æª¢æ¸¬çµæœ
      if (data.sensitiveCheckResult) {
        html += '<div class="check-section">';
        html += '<h4>ğŸš« æ•æ„Ÿè©æª¢æ¸¬</h4>';
        
        if (data.sensitiveCheckResult.hasSensitiveContent) {
          if (data.sensitiveCheckResult.sensitiveWords && data.sensitiveCheckResult.sensitiveWords.length > 0) {
            data.sensitiveCheckResult.sensitiveWords.forEach(word => {
              html += `<div class="check-item error">ç™¼ç¾æ•æ„Ÿè©ï¼š${word}</div>`;
            });
          }
          if (data.sensitiveCheckResult.issues && data.sensitiveCheckResult.issues.length > 0) {
            data.sensitiveCheckResult.issues.forEach(issue => {
              html += `<div class="check-item error">âš ï¸ ${issue}</div>`;
            });
          }
        } else {
          html += '<div class="check-item pass">âœ… æœªç™¼ç¾æ•æ„Ÿè©</div>';
        }
        
        if (data.sensitiveCheckResult.summary) {
          html += `<div class="check-item warning">ğŸ“‹ ${data.sensitiveCheckResult.summary}</div>`;
        }
        
        html += '</div>';
      }
      
      // æ³•è¦æª¢æ¸¬çµæœ
      if (data.regulatoryCheckResult) {
        html += '<div class="check-section">';
        html += '<h4>âš–ï¸ æ³•è¦åˆè¦æª¢æ¸¬</h4>';
        
        if (data.regulatoryCheckResult.hasRegulatoryIssues) {
          if (data.regulatoryCheckResult.violations && data.regulatoryCheckResult.violations.length > 0) {
            data.regulatoryCheckResult.violations.forEach(violation => {
              html += `<div class="check-item error">âš ï¸ ${violation}</div>`;
            });
          }
        } else {
          html += '<div class="check-item pass">âœ… æœªç™¼ç¾æ³•è¦é•è¦</div>';
        }
        
        if (data.regulatoryCheckResult.missingElements && data.regulatoryCheckResult.missingElements.length > 0) {
          html += '<div class="check-item warning">ğŸ“‹ ç¼ºå°‘å¿…è¦å…ƒç´ ï¼š</div>';
          data.regulatoryCheckResult.missingElements.forEach(element => {
            html += `<div class="check-item warning">â€¢ ${element}</div>`;
          });
        }
        
        if (data.regulatoryCheckResult.summary) {
          html += `<div class="check-item warning">ğŸ’¡ ${data.regulatoryCheckResult.summary}</div>`;
        }
        
        html += '</div>';
      }
      
      // å›é¥‹å»ºè­°
      if (data.feedback) {
        html += '<div class="check-section">';
        html += '<h4>ğŸ’¬ å›é¥‹å»ºè­°</h4>';
        
        // å°‡å›é¥‹æ–‡å­—è½‰æ›ç‚º HTML æ ¼å¼
        const feedbackHtml = data.feedback
          .replace(/### (.*?)\n/g, '<h5 style="margin: 15px 0 10px 0; color: #333; font-size: 16px;">$1</h5>')
          .replace(/#### (.*?)\n/g, '<h6 style="margin: 10px 0 5px 0; color: #555; font-size: 14px;">$1</h6>')
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\n\n/g, '</p><p style="margin: 8px 0;">')
          .replace(/\n/g, '<br>');
        
        html += `<div class="check-item pass" style="text-align: left; line-height: 1.6;"><p style="margin: 8px 0;">${feedbackHtml}</p></div>`;
        
        html += '</div>';
      }
      
      checkContent.innerHTML = html;
    }
  </script>
</body>
</html>